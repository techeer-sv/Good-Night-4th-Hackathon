# Good-Night-4th-Hackathon
공연 좌석 예매 시스템 풀스택 구현

## 안내사항

- 본 레포지토리를 **fork**하여 과제를 수행하고, 완료시 PR을 보냅니다.
- 과제의 소스코드는 본인의 GitHub 레포지토리에 **Public**으로 올려주세요.
- 진행 간 문의사항은 이 레포지토리의 Issue로 등록해주세요.
- 구현 내용은 README.md 하단에 이어서 작성해 주세요.

## 과제 목표

공연 좌석 예매 시스템 구현

### 기술 스택

- Backend: 자유 선택 (Spring Boot, Node.js, Django, FastAPI 등)
- Frontend: 자유 선택 (React, Vue, Svelte, Vanilla JS 등)
- Database: 자유 선택
- 선택한 기술 스택에 대한 이유를 README에 간단히 설명해주세요

### 평가 항목

- 문제 해결 접근 방식에서 기술적 의사결정
- 구현 완성도와 문서화 수준

## 요구사항

### 최소 요구사항
> 아래 목표들을 달성하기 위한 구현 방법은 자유롭게 선택하세요.

1. **좌석 현황 표시**
    - 3x3 격자 형태로 총 9개의 좌석 표시
    - 각 좌석의 예약 가능/불가능 상태를 시각적으로 구분
2. **좌석 예약 기능**
    - 사용자가 빈 좌석을 클릭하여 선택
    - 페이지를 이동하여 예약자 정보 입력
    - 정보 입력 완료 후 예약 확정 시도
        - 99% 확률로 예약 성공 처리
        - 1% 확률로 의도적 실패 처리
    - 예약 성공/실패에 대한 명확한 피드백 제공
3. **API 엔드포인트**
    - 좌석 목록 조회 API
    - 좌석 예약 요청 API
    - HTTP 통신을 통한 데이터 교환
4. **코드 품질 보장**
    - 테스트 코드
    - 타입 체크
    - 린팅

### 기본 요구사항

> 아래 목표들을 달성하기 위한 구현 방법은 자유롭게 선택하세요.

> 각 목표를 어떻게 해결했는지 README에 설명해주세요.

1. **사용자 경험 개선**
    - **목표**: 사용자가 서비스를 이용할 때 발생할 수 있는 불편함 최소화
    - **예시**
        - 직관적인 UI
        - 네트워크 지연이 발생했을 때 편의성
        - 예약이 실패했을 때 편의성
        - 모바일에서 접속했을 때 편의성
2. **안정적인 서비스 운영**
    - **목표**: 예상치 못한 상황에서도 서비스가 안정적으로 동작
    - **예시**
        - 잘못된 요청이 들어왔을 때
        - 존재하지 않는 좌석을 예약하려 할 때
        - 서버 에러가 발생했을 때
        - 데이터 정합성 보장

### 심화 요구사항

> 아래 목표들을 달성하기 윈한 구현 방법은 자유롭게 선택하세요.

> 각 목표를 달성했음을 검증할 방법을 마련하세요.

> 시도한 방법이 어떤 방식으로 문제를 해결했으며 보유한 한계점에 대해 상세히 README에 설명해주세요.


1. **동시성 제어**
    - **상황**: 여러 사용자가 동시에 같은 좌석을 예약하려고 시도하는 경우
    - **목표**: 한 좌석에 대해 단 한 명만 예약에 성공하도록 보장
2. **실시간 좌석 상태 동기화**
    - 상황: UI에서 사용자들이 이미 선택된 좌석을 선택하게 되는 경우
    - 목표: 실시간 좌석 예약 상태를 확인할 수 있도록 실시간 동기화 제공
3. **선택한 좌석에 대한 우선순위 제공**
    - 상황 : 좌석 선택 후 예약자 정보를 입력하는 동안 다른 사용자가 좌석을 예약하게 되는 경우
    - 목표: 동일 좌석에 대해 먼저 선택을 한 사용자에게 예약 우선순위 제공

## 참고사항

### 진행 방식

- 최소 요구사항을 먼저 완성한 후 기본 기능을 구현해주세요
- 심화 요구사항은 구현에 실패해도 고민한 해결 방법이 있으면 작성해주세요.

### 필수 제출 항목

- **README.md**: 다음 내용을 반드시 포함
    - 프로젝트 실행 방법 (상세하게)
    - 기술 스택 선택 이유
    - 구현한 요구사항 체크리스트
    - 각 요구사항별 해결 방법 설명

### 선택 제출 항목

- 아키텍처 다이어그램
- 시연 영상 또는 GIF

---

<!-- 구현 내용 작성 -->
# Backend
## API 엔드포인트

| Method | 이름 | Endpoint | 설명 |
|--------|------|----------|------|
| `GET` | 좌석 목록 조회 | `/api/seats` | 전체 좌석 예약 여부 조회 (프론트 조회용) |
| `GET` | 예약 내역 확인 | `/api/reservations` | 사용자 정보(JSON)를 전달하면 예약 좌석 목록 반환 |
| `POST` | 좌석 잠금 | `/api/seats/{seatId}/lock` | Redis에 좌석 잠금 정보 저장. 세션ID 필요. TTL 200초 설정 |
| `DELETE` | 좌석 잠금 해제 | `/api/seats/{seatId}/lock` | Redis에서 잠금 정보 삭제 |
| `GET` | 좌석 잠금 여부 조회 | `/api/seats/{seatId}/lock` | 해당 좌석이 잠겨있는지 확인 (프론트 동기화용) |
| `POST` | 좌석 예약 시도 | `/api/seats/{seatId}/reserve` | 사용자 정보 전달 후 좌석 예약 시도 |

---

### 요청 & 응답 예시

#### 1. 좌석 목록 조회 `GET /api/seats`

- 응답 JSON:
```json
[
  {
    "seatId": 1,
    "seatNumber": "A1",
    "isReserved": false
  },
  {
    "seatId": 2,
    "seatNumber": "A2",
    "isReserved": true
  },
  {
    "seatId": 3,
    "seatNumber": "A3",
    "isReserved": false
  }
]
```

---

#### 2. 예약 내역 확인 `GET /api/reservations`

- 요청 JSON:
```json
{
  "userName": "boseong",
  "ph": "010-1111-1111"
}
```

- 응답 JSON:
```json
{
  "seatId": [1, 2, 3]
}
```

---

#### 3. 좌석 잠금 `POST /api/seats/{seatId}/lock`

- 요청 JSON:
```json
{
  "seatId": 5,
  "sessionId": 3
}
```

- 응답 JSON (성공 시):
```json
{
  "message": "좌석이 성공적으로 잠금 처리되었습니다.",
  "seatId": 5,
  "sessionId": 3,
  "lockedAt": 1724192769215
}
```

- 실패 응답 예시:
```json
{
  "error": "이미 다른 사용자가 좌석을 선택 중입니다."
}
```

---

#### 4. 좌석 잠금 해제 `DELETE /api/seats/{seatId}/lock`

- 요청 파라미터:  
  `sessionId=3`

- 응답 JSON:
```json
{
  "message": "좌석 잠금이 해제되었습니다.",
  "seatId": 5
}
```

---

#### 5. 좌석 잠금 여부 조회 `GET /api/seats/{seatId}/lock`

- 응답 JSON:
```json
{
  "seatId": 5,
  "locked": true
}
```

---

#### 6. 좌석 예약 시도 `POST /api/seats/{seatId}/reserve`

- 요청 JSON:
```json
{
  "seatId": 1,
  "userName": "boseong",
  "ph": "010-1111-1111"
}
```

- 응답 JSON:
```json
{
  "seatId": 1,
  "reserved": true,
  "userId": 3
}
```
#### 추가 사항
- 휴대폰 번호 입력 시, 010-xxxx-xxxx의 형식 지키도록 유효성 검사 추가
  - VO(값 객체)를 사용하여 전화번호 입력 방식을 지정하고, 이에 대한 유효성 검사를 구현함
- 락 설정 방식 : Redis를 활용한 분산 락
   - 좌석 클릭 시
     - 해당 세션id를 Redis에 seat:{seatId} 키로 sessionId 저장
     - 이미 다른 세션으로 잠금된 경우 -> 실패 응답 반환
   - 좌석 잠금 해제
     - Redis에서 해당 키 삭제
     - 세션 불일치 혹은 TTL초과 시 만료(TTL은 200초로 설정)
   - 좌석 예약 시
     - 해당 좌석이 Redis에 잠금되어있고, 그 세션이 현재 요청자의 SessionId와 일치하면 예약
     - 예약 성공 시, Redis에서 해당 키 삭제, DB에 추가